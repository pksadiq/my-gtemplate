stages:
  - build
  - test
  - deploy

build:
  image: pksadiq/gtk:alpine-amd64
  stage: build
  variables:
    CCACHE_BASEDIR: "${CI_PROJECT_DIR}"
    CCACHE_DIR: "${CCACHE_BASEDIR}/_ccache-gtk3"
    MESON_ARGS: "--buildtype=debugoptimized -Dhelp=true -Dgtk_doc=true"
  script:
    - meson ${MESON_ARGS} _build
    - ccache --zero-stats
    - ninja -C _build
    - ccache --show-stats
  cache:
    key: build-gtk3
    paths:
      - _ccache-gtk3/

pages:
  image: busybox:1
  stage: deploy
  script:
    - mkdir public
    - mv _build/meson-logs/coveragereport ${CI_PROJECT_DIR}/public/coverage
  artifacts:
    paths:
      - public
  only:
    - master
